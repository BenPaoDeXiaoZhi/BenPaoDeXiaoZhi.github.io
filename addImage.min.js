(function(e){const{ArgumentType:t,BlockType:s,TargetType:a,Cast:r,translate:o,extensions:n,runtime:i}=e;o.setup({zh:{extensionName:"我的扩展 demo",reporterBlock:"[TEXT]的第[LETTER_NUM] 个字母","myReporter.TEXT_default":"abcdefg"},en:{extensionName:"ext demo",reporterBlock:"letter [LETTER_NUM] of [TEXT]","myReporter.TEXT_default":"abcdefg"}});class m{constructor(e){this._runtime=e}getInfo(){const e={opcode:"addNewCostume",blockType:s.REPORTER,text:"向名为[TARGET_NAME]的角色添加URL为[URL],名为[COSTUME_NAME]的造型并设置旋转中心坐标为x:[CENTER_X],y:[CENTER_Y],并[WAIT],然后[SHOW]",arguments:{TARGET_NAME:{type:t.STRING,menu:"select_sprite"},URL:{type:t.STRING,defaultValue:"https://files.meng-files.us.kg/chr/momoka/momoka_spr-00.png"},COSTUME_NAME:{type:t.STRING,defaultValue:"0721"},CENTER_X:{type:t.NUMBER,defaultValue:0},CENTER_Y:{type:t.NUMBER,defaultValue:0},WAIT:{type:t.NUMBER,menu:"wait"},SHOW:{type:t.NUMBER,menu:"show"}}};return{id:"addImage",color1:"#FF8C1A",color2:"#DB6E00",name:"将第三方图片作为造型",blocks:[e],menus:{select_sprite:{acceptReporters:!0,items:"selectSprites"},wait:{acceptReporters:!0,items:[{text:"等待",value:"1"},{text:"不等待",value:"0"}]},show:{acceptReporters:!0,items:[{text:"显示",value:"1"},{text:"不显示",value:"0"}]}}}}selectSprites(){var e=[{text:"当前角色",value:"__this__"}],t=this._runtime.targets;for(var s in t)if(t[s].isOriginal&&!t[s].isStage){var a=t[s].getName();e.push({text:a,value:a})}return e}getSpriteFromMenu(e){return"__this__"==e?this._runtime.getEditingTarget():this._runtime._runtime.getSpriteTargetByName(e)}async addNewCostume(e){var{TARGET_NAME:t="",URL:s="",COSTUME_NAME:a="",CENTER_X:r=0,CENTER_Y:o=0,WAIT:n=1,SHOW:m=1}=e,u=s,g=this.getSpriteFromMenu(t);const d=await fetch(s,{method:"GET"}),p=d.headers.get("content-type");if(!this._typeIsBitmap(p)&&"image/svg+xml"!==p)return console.log(d),console.error(`不支持的MIME格式${p}`),-1;const c=new Uint8Array(await d.arrayBuffer()),l=this._typeIsBitmap(p)?this._runtime.storage.AssetType.ImageBitmap:this._runtime.storage.AssetType.ImageVector,T="image/svg+xml"===p?i.storage.DataFormat.SVG:i.storage.DataFormat.PNG,E=i.storage.createAsset(l,T,new Uint8Array(c),null,!0),_=`${E.assetId}.${E.dataFormat}`;var f={name:a,dataFormat:E.dataType,asset:E,md5:_,assetId:E.assetId,isRuntimeAsyncLoad:!0,rotationCenterX:r,rotationCenterY:o,bitmapResolution:"svg"===E.dataFormat?1:2};const R=g.getCostumes();if(-1!=R.findIndex(e=>e.assetId===E.assetId&&e.name===a)){if(console.log(`相同造型已存在,md5:${_}`),1==m){const e=g.getCostumes();let t=e.findIndex(e=>e.assetId===E.assetId&&e.name===a);g.setCostume(t)}return 1}if(1==n){if(await this._runtime.addAsyncCostumeToTarget(_,f,g,!1),1==m){const e=g.getCostumes();let t=e.findIndex(e=>e.assetId===E.assetId&&e.name===a);g.setCostume(t)}}else{const e=this._runtime.addAsyncCostumeToTarget(_,f,g,!1);if(1==m){const t=g.getCostumes();let s=t.findIndex(e=>e.assetId===E.assetId&&e.name===a);e.then(()=>(function(){g.setCostume(s)}))}}return console.log(g,d,c,u,E,a,r,o,m),0}_typeIsBitmap(e){return"image/png"===e||"image/bmp"===e||"image/jpg"===e||"image/jpeg"===e||"image/jfif"===e||"image/webp"===e||"image/gif"===e}}n.register(new m(i))})(Scratch);